<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Custom Hourglass Timer</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background-color: white;
      transition: background-color 0.3s ease;
    }

    #timer {
      font-size: 64px;
      margin: 50px;
      color: black;
      transition: color 0.3s ease;
    }

    button, input {
      font-size: 22px;
      margin: 20px 5px;
      padding: 15px 25px;
      border-radius: 10px;
      border: 1px solid black;
    }

    input[type="number"] {
      width: 40px;
    }

    .flash-once {
      animation: flash 1s 3;
    }

    @keyframes flash {
      0%   { background-color: white; }
      50%  { background-color: rgb(254, 207, 207); }
      100% { background-color: white; }
    }

    /* Hourglass container */
    #hourglass {
      position: relative;
      width: 250px;
      height: 540px;
      margin: 20px auto;
      background: linear-gradient(to bottom, #cccccc 0%, #f4f4f4 20%, #f4f4f4 30%, #cccccc 50%, #f4f4f4 70%, #f4f4f4 80%, #cccccc 100%);
      clip-path: polygon(15% 0%, 85% 0%, 95% 15%, 85% 35%, 55% 50%, 85% 65%, 95% 85%, 85% 100%, 15% 100%, 5% 85%, 15% 65%, 45% 50%, 15% 35%, 5% 15%);
      border: 4px solid rgb(70, 49, 31);
      overflow: hidden;
    }

    /* Top sand */
    #topSand {
      position: absolute;
      width: 100%;
      height: 50%;
      background-color: #b48055;
      clip-path: polygon(0% 50%, 100% 50%, 100% 100%, 0% 100%);
      transition: all 0.5s linear;
      bottom: 50%;
      transform-origin: bottom;
    }

    /* Bottom sand */
    #bottomSand {
      position: absolute;
      width: 100%;
      height: 0;
      bottom: 0;
      background-color: #b48055;
      clip-path: polygon(0% 55%, 50% 35%, 100% 55%, 100% 100%, 0% 100%);
      transition: all 0.5s linear;
      transform-origin: top;
    }

    /* Falling sand */
    #fallingSand {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 5%;
      height: 100%;
      transform: translateX(-50%);
      /* overflow: hidden; */
    }

    /* Sand particle */
    .sandParticle {
      position: absolute;
      width: 0.6vh;
      height: 0.6vh;
      background-color: #b48055;
      border-radius: 50%;
      animation: fall 1s ease-in infinite;
    }

    /* Falling animation */
    @keyframes fall {
      0% {
        transform: translateY(0);
        opacity: 1;
      }
      100% {
        transform: translateY(3000%);
        opacity: 0.2;
      }
    }
    /* Add flip animation */
    @keyframes flip {
      0% {
      transform: rotate(0deg);
      }
      100% {
      transform: rotate(180deg);
      }
    }

    #hourglass.flipping {
      animation: flip 0.5s ease-in-out forwards;
    }
  </style>
</head>
<body>

  <div>
    <label for="customMinutes">Minutes:</label>
    <input type="number" id="customMinutes" min="0" value="5" onchange="setCustomTime()">
    <label for="customSeconds">Seconds:</label>
    <input type="number" id="customSeconds" min="0" max="59" value="0" onchange="setCustomTime()">
  </div>

  <button id="startBtn" onclick="toggleTimer()">Start</button>
  <button id="resetBtn" onclick="resetTimer()">Reset</button>
  <button id="flipBtn" onclick="flipTimer()">Flip</button>

  <div id="timer">05:00</div>

  <div id="hourglass">
    <div id="topSand"></div>
    <div id="fallingSand"></div>
    <div id="bottomSand"></div>
  </div>

  <script>
    let totalTime = 5 * 60;
    let timePassed = 0;
    let timerInterval = null;
    let running = false;
    let alertTimeout = null;

    const timerDisplay = document.getElementById("timer");
    const body = document.body;
    const startBtn = document.getElementById("startBtn");
    const flipBtn = document.getElementById("flipBtn");
    const resetBtn = document.getElementById("resetBtn");

    startBtn.style.display = "inline-block";
    flipBtn.style.display = "inline-block";
    resetBtn.style.display = "none";

    const hourglass = document.getElementById("hourglass");
    hourglass.addEventListener("click", flipTimer);

    function updateTimerDisplay() {
      const timeLeft = totalTime - timePassed;

      if (timeLeft <= 10 && timeLeft > 0) {
        timerDisplay.style.color = 'red';
      } else {
        timerDisplay.style.color = 'black';
      }

      if (timeLeft <= 0) {
        timerDisplay.textContent = "TIME'S UP!";
        fallingSand.innerHTML = '';


        body.classList.add('flash-once');
        if (!alertTimeout) {
          alertTimeout = setTimeout(() => {
            body.classList.remove('flash-once');
            alertTimeout = null;
          }, 3000);
        }
      } else {
        const minutes = String(Math.floor(timeLeft / 60)).padStart(2, '0');
        const seconds = String(timeLeft % 60).padStart(2, '0');
        timerDisplay.textContent = `${minutes}:${seconds}`;
      }
    }

    function manageButtons() {
      const timeLeft = totalTime - timePassed;

      if (timePassed === 0 && !running) {
        startBtn.style.display = "inline-block";
        resetBtn.style.display = "none";
        flipBtn.style.display = "inline-block";
        return;
      }

      if (timeLeft <= 0) {
        startBtn.style.display = "none";
        resetBtn.style.display = "inline-block";
        flipBtn.style.display = "none";
      } else {
        startBtn.style.display = "inline-block";
        resetBtn.style.display = "inline-block";
        flipBtn.style.display = "inline-block";
      }

      if (running) {
        startBtn.textContent = "Pause";
      } else {
        startBtn.textContent = "Start";
      }
    }

    function updateDisplay() {
      updateTimerDisplay();
      manageButtons();
    }

    function updateHourglass() {
      const timeLeft = totalTime - timePassed;
      const percentage = timeLeft / totalTime;

      const topSand = document.getElementById("topSand");
      const bottomSand = document.getElementById("bottomSand");
      const fallingSand = document.getElementById("fallingSand");

      topSand.style.height = `${percentage * 50}%`;
      bottomSand.style.height = `${(1 - percentage) * 50}%`;

      if (timeLeft == 0) {
        fallingSand.innerHTML = '';
      }
    }

    function createSandParticles() {
      const fallingSand = document.getElementById("fallingSand");
      fallingSand.innerHTML = '';

      const particleCount = 10;
      for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement("div");
        particle.classList.add("sandParticle");
        particle.style.left = `${Math.random() * 100-15}%`;
        particle.style.animationDelay = `${Math.random()}s`;
        fallingSand.appendChild(particle);
      }
    }

    function toggleTimer() {
      if (running) {
        clearInterval(timerInterval);
        running = false;
        startBtn.textContent = "Start";
        resetBtn.style.display = "inline-block";
        fallingSand.innerHTML = '';
      } else {
        timerInterval = setInterval(() => {
          timePassed++;
          if (timePassed >= totalTime) {
            timePassed = totalTime;
            clearInterval(timerInterval);
            running = false;
            startBtn.textContent = "Start";
          }
          updateDisplay();
          updateHourglass();
        }, 1000);
        running = true;
        startBtn.textContent = "Pause";
        resetBtn.style.display = "inline-block";
        createSandParticles();
      }
    }

    function resetTimer() {
      clearInterval(timerInterval);
      if (alertTimeout) {
        clearTimeout(alertTimeout);
        alertTimeout = null;
      }

      timePassed = 0;
      running = false;
      timerDisplay.style.color = 'black';
      body.classList.remove('flash-once');
      startBtn.textContent = "Start";

      const topSand = document.getElementById("topSand");
      const bottomSand = document.getElementById("bottomSand");
      const fallingSand = document.getElementById("fallingSand");

      topSand.style.height = "50%";
      bottomSand.style.height = "0%";
      fallingSand.innerHTML = '';

      updateDisplay();
      updateHourglass();
       fallingSand.innerHTML = '';
    }

    function flipTimer() {
      const timeLeft = totalTime - timePassed;

      if (timeLeft <= 0) {
        return;
      }

      timePassed = timeLeft;
      updateDisplay();

      const hourglass = document.getElementById("hourglass");
      const topSand = document.getElementById("topSand");
      const bottomSand = document.getElementById("bottomSand");

      const topSandHeight = parseFloat(topSand.style.height) || 50;
      const bottomSandHeight = parseFloat(bottomSand.style.height) || 0;

      topSand.style.transition = "height 1s ease-in-out";
      bottomSand.style.transition = "height 1s ease-in-out";

      topSand.style.height = `${bottomSandHeight}%`;
      bottomSand.style.height = `${topSandHeight}%`;

      hourglass.classList.add("flipping");

      hourglass.addEventListener("animationend", function handleFlipEnd() {
        hourglass.classList.remove("flipping");

        topSand.style.transition = "";
        bottomSand.style.transition = "";

        hourglass.removeEventListener("animationend", handleFlipEnd);
      });
    }

    function setCustomTime() {
      const minutes = parseInt(document.getElementById("customMinutes").value) || 0;
      const seconds = parseInt(document.getElementById("customSeconds").value) || 0;
      totalTime = (minutes * 60) + seconds;
      timePassed = 0;
      resetTimer();
    }

    setCustomTime();
    updateHourglass();
  </script>

</body>
</html>
